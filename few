#!/usr/bin/env ruby
require 'pathname'
require 'tempfile'
require 'cgi'

def open_browser(path)
  case RUBY_PLATFORM
  when /darwin/
    system 'open', path
  when /mswin(?!ce)|mingw|cygwin|bccwin/
    system 'start', path
  else
    system 'firefox', path
  end
end

t = Tempfile.new('few')

File.open(t.path, 'w') do |io|
  a = ARGF.read
  a = a.gsub(/\r?\n/, "<br />\n")
  # TODO: use CSS; text-indent: xx em;
  a = a.gsub(/^\s+/) {|m| '<font color=white>' + "_"*m.size  + '</font>' }
  io.puts <<-EOF
  <html>
    <head><title>#{ARGF.filename}</title></head>
    <body>
    #{a}
    </body>
  </html>
  EOF
end

t.close

File.rename(t.path, html = t.path + '.html')

open_browser(html)

# vim: set filetype=ruby :
